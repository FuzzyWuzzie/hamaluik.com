<!DOCTYPE html> <html lang="en-CA"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Writing an Editor Extension to Customize Mesh Colours in Unity</title> <link rel="alternate" type="application/rss+xml" href="https://blog.hamaluik.ca/feed.rss" title="Posts RSS"> <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"> <link rel="manifest" href="/site.webmanifest"> <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ff5555"> <meta name="msapplication-TileColor" content="#ff5555"> <meta name="theme-color" content="#ff5555"> <meta property="og:title" content="Writing an Editor Extension to Customize Mesh Colours in Unity"/> <meta property="og:url" content="http://blog.hamaluik.ca/posts/writing-an-editor-extension-to-customize-mesh-colours-in-unity/"/> <meta property="og:image" content="https://og-image.now.sh/Writing%20an%20Editor%20Extension%20to%20Customize%20Mesh%20Colours%20in%20Unity.png?theme=light&md=0&fontSize=75px&images=https%3A%2F%2Fassets.zeit.co%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fhyper-color-logo.svg&widths=350&heights=350"/> <meta property="og:description" content="I&#x27;m an engineer and a programmer, not an artist. This sometimes becomes an issue for me when I work on games as while I can make the game technically sound, the art is often downright horrible, or I spend way more time on it than I have any right to. I&#x27;m currently working on a long-term, back-burner type game project to keep me busy and distracted when I occasionally need a break from real life. Programming-wise, I&#x27;m fine, but what&#x27;s a game without art? Well, aside from Dwarf Fortress and most Roguelikes out there, it&#x27;s not much. Fortunately, I recently stumbled across (what I think) is a great art style - geometric assets, as shown below"/> <meta property="og:type" content="article"/> <meta property="og:locale" content="en_CA"/> <meta property="og:site_name" content="Kenton Hamaluik"/> <meta property="article:published_time" content=" 2013-11-22T22:29:00+00:00 "/> <meta property="article:author" content="http://blog.hamaluik.ca/"/> <meta property="article:tag" content="Unity"/> <meta name="twitter:card" content="summary_large_image"/> <meta name="twitter:image:alt" content="Writing an Editor Extension to Customize Mesh Colours in Unity"/> <style> @font-face {font-family:"Crimson Pro";font-style:italic;font-weight:400;font-display:swap;src:local("Crimson Pro Italic"),local("CrimsonPro Italic"),local("Crimson-Pro-Italic"),local("CrimsonPro-Italic"),url(/fonts/crimson-pro-normal-latin-ext.woff2) format("woff2"),url(/fonts/CrimsonPro-Italic.ttf) format("ttf");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face {font-family:"Crimson Pro";font-style:italic;font-weight:400;font-display:swap;src:local("Crimson Pro Italic"),local("CrimsonPro Italic"),local("Crimson-Pro-Italic"),local("CrimsonPro-Italic"),url(/fonts/crimson-pro-italic-latin.woff2) format("woff2"),url(/fonts/CrimsonPro-Italic.ttf) format("ttf");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}@font-face {font-family:"Crimson Pro";font-style:normal;font-weight:400;font-display:swap;src:local("Crimson Pro"),local("CrimsonPro"),local("Crimson-Pro"),local("CrimsonPro"),url(/fonts/crimson-pro-normal-latin-ext.woff2) format("woff2"),url(/fonts/CrimsonPro-Regular.ttf.ttf) format("ttf");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face {font-family:"Crimson Pro";font-style:normal;font-weight:400;font-display:swap;src:local("Crimson Pro"),local("CrimsonPro"),local("Crimson-Pro"),local("CrimsonPro"),url(/fonts/crimson-pro-normal-latin.woff2) format("woff2"),url(/fonts/CrimsonPro-Regular.ttf.ttf) format("ttf");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}@font-face {font-family:"Crimson Pro";font-style:normal;font-weight:700;font-display:swap;src:local("Crimson Pro Bold"),local("CrimsonPro Bold"),local("Crimson-Pro-Bold"),local("CrimsonPro-Bold"),url(/fonts/crimson-pro-bold-latin-ext.woff2) format("woff2"),url(/fonts/CrimsonPro-Bold.ttf.ttf) format("ttf");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face {font-family:"Crimson Pro";font-style:normal;font-weight:700;font-display:swap;src:local("Crimson Pro Bold"),local("CrimsonPro Bold"),local("Crimson-Pro-Bold"),local("CrimsonPro-Bold"),url(/fonts/crimson-pro-bold-latin.woff2) format("woff2"),url(/fonts/CrimsonPro-Bold.ttf.ttf) format("ttf");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}:root{--background-colour:#fafafa;--font-colour:#222;--footer-colour:#222;--link-colour:#076678;--visited-colour:#8f3f71;--theme-background:#282a36;--theme-currentline:#44475a;--theme-selection:#44475a;--theme-foreground:#f8f8f2;--theme-comment:#6272a4;--theme-cyan:#8be9fd;--theme-green:#50fa7b;--theme-orange:#ffb86c;--theme-pink:#ff79c6;--theme-purple:#bd93f9;--theme-red:#ff5555;--theme-yellow:#f1fa8c;}*{box-sizing:border-box;margin:0;}body{display:flex;flex-direction:column;min-height:100vh;padding:1rem clamp(1rem,5vw,3rem) 1rem;font-family:"Crimson Pro",Constantia,"Lucida Bright",Lucidabright,"Lucida Serif",Lucida,"DejaVu Serif","Bitstream Vera Serif","Liberation Serif",Georgia,serif;font-size:16pt;line-height:1.5;color:var(--font-colour);background:var(--background-colour);}body>*{--layout-spacing:max(2vh,2rem);width:100%;max-width:70ch;margin-left:auto;margin-right:auto;}main{margin-top:var(--layout-spacing);}footer{margin-top:auto;padding-top:var(--layout-spacing);}footer p{border-top:1px solid var(--footer-colour);padding-top:0.25em;font-size:0.9rem;color:var(--footer-colour);display:flex;justify-content:space-between;}:is(h1,h2,h3){line-height:1.2;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue;}:is(h2,h3,figure):not(:first-child){margin-top:2em;}article*+*{margin-top:1em;}a{word-break:break-all;color:var(--link-colour);text-underline-offset:0.15em;}a:visited{color:var(--visited-colour);}:not(pre)>code{word-break:break-all;font-family:"Source Code Pro","Fira Code","Fira Mono",Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;font-size:12pt;}pre,figure{overflow-x:auto;}figure{display:flex;flex-direction:column;align-items:center;justify-content:center;max-width:100%;}figure>a>img,figure>img,figure>video{max-width:100%;margin:0 auto;}figure figcaption{font-size:0.8rem;text-align:center;}time{font-size:0.8rem;}header h1 a{color:var(--font-colour);font-size:4rem;font-weight:bold;word-break:normal;}header h1 a:visited{color:var(--font-colour);}svg{color:var(--font-colour);fill:currentColor;}img.white{mix-blend-mode:multiply;}.highlight{font-family:"Source Code Pro","Fira Code","Fira Mono",Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;font-size:12pt;padding:0.25em;margin:1em 0;}.highlight .hll{background-color:#ffffcc;}.highlight{background:#282828;color:#ebdbb2;background-color:#282828;}.highlight .c{color:#928374;font-style:italic;background-color:#282828;}.highlight .err{color:#ebdbb2;background-color:#282828;}.highlight .esc{color:#ebdbb2;background-color:#282828;}.highlight .g{color:#ebdbb2;background-color:#282828;}.highlight .k{color:#fe8019;background-color:#282828;}.highlight .l{color:#ebdbb2;background-color:#282828;}.highlight .n{color:#ebdbb2;background-color:#282828;}.highlight .o{color:#fe8019;background-color:#282828;}.highlight .x{color:#ebdbb2;background-color:#282828;}.highlight .p{color:#ebdbb2;background-color:#282828;}.highlight .ch{color:#928374;font-style:italic;background-color:#282828;}.highlight .cm{color:#928374;font-style:italic;background-color:#282828;}.highlight .cp{color:#8ec07c;background-color:#282828;}.highlight .c1{color:#928374;font-style:italic;background-color:#282828;}.highlight .cs{color:#928374;font-style:italic;background-color:#282828;}.highlight .gd{color:#282828;background-color:#fb4934;}.highlight .ge{color:#83a598;text-decoration:underline;background-color:#282828;}.highlight .gr{color:#ebdbb2;font-weight:bold;background-color:#fb4934;}.highlight .gh{color:#b8bb26;font-weight:bold;background-color:#282828;}.highlight .gi{color:#282828;background-color:#b8bb26;}.highlight .go{color:#504945;background-color:#282828;}.highlight .gp{color:#ebdbb2;background-color:#282828;}.highlight .gs{color:#ebdbb2;background-color:#282828;}.highlight .gu{color:#b8bb26;font-weight:bold;background-color:#282828;}.highlight .gt{color:#ebdbb2;font-weight:bold;background-color:#fb4934;}.highlight .kc{color:#fe8019;background-color:#282828;}.highlight .kd{color:#fe8019;background-color:#282828;}.highlight .kn{color:#fe8019;background-color:#282828;}.highlight .kp{color:#fe8019;background-color:#282828;}.highlight .kr{color:#fe8019;background-color:#282828;}.highlight .kt{color:#fabd2f;background-color:#282828;}.highlight .ld{color:#ebdbb2;background-color:#282828;}.highlight .m{color:#d3869b;background-color:#282828;}.highlight .s{color:#b8bb26;background-color:#282828;}.highlight .na{color:#b8bb26;font-weight:bold;background-color:#282828;}.highlight .nb{color:#fabd2f;background-color:#282828;}.highlight .nc{color:#ebdbb2;background-color:#282828;}.highlight .no{color:#d3869b;background-color:#282828;}.highlight .nd{color:#ebdbb2;background-color:#282828;}.highlight .ni{color:#fabd2f;background-color:#282828;}.highlight .ne{color:#fb4934;background-color:#282828;}.highlight .nf{color:#fabd2f;background-color:#282828;}.highlight .nl{color:#fb4934;background-color:#282828;}.highlight .nn{color:#ebdbb2;background-color:#282828;}.highlight .nx{color:#ebdbb2;background-color:#282828;}.highlight .py{color:#ebdbb2;background-color:#282828;}.highlight .nt{color:#fb4934;background-color:#282828;}.highlight .nv{color:#ebdbb2;background-color:#282828;}.highlight .ow{color:#fe8019;background-color:#282828;}.highlight .w{color:#ebdbb2;background-color:#282828;}.highlight .mb{color:#d3869b;background-color:#282828;}.highlight .mf{color:#d3869b;background-color:#282828;}.highlight .mh{color:#d3869b;background-color:#282828;}.highlight .mi{color:#d3869b;background-color:#282828;}.highlight .mo{color:#d3869b;background-color:#282828;}.highlight .sb{color:#b8bb26;background-color:#282828;}.highlight .sc{color:#b8bb26;background-color:#282828;}.highlight .sd{color:#b8bb26;background-color:#282828;}.highlight .s2{color:#b8bb26;background-color:#282828;}.highlight .se{color:#b8bb26;background-color:#282828;}.highlight .sh{color:#b8bb26;background-color:#282828;}.highlight .si{color:#b8bb26;background-color:#282828;}.highlight .sx{color:#b8bb26;background-color:#282828;}.highlight .sr{color:#b8bb26;background-color:#282828;}.highlight .s1{color:#b8bb26;background-color:#282828;}.highlight .ss{color:#83a598;background-color:#282828;}.highlight .bp{color:#fabd2f;background-color:#282828;}.highlight .vc{color:#ebdbb2;background-color:#282828;}.highlight .vg{color:#ebdbb2;background-color:#282828;}.highlight .vi{color:#ebdbb2;background-color:#282828;}.highlight .il{color:#d3869b;background-color:#282828;}.slideshow{width:100%;}.slideshow .slides{display:grid;grid-auto-flow:column;grid-gap:1.5rem;overflow-x:auto;scroll-snap-type:x mandatory;padding:0 0 1.5rem;-webkit-overflow-scrolling:touch;}.slideshow .slides>*{width:min(45ch,60vw);height:auto;scroll-snap-align:center;scroll-snap-stop:always;}</style> </head> <body> <header> <h1><a href="https://blog.hamaluik.ca/">Kenton Hamaluik</a></h1> </header> <main> <article> <header> <h1> Writing an Editor Extension to Customize Mesh Colours in Unity <time datetime='2013-11-22T22:29:00+00:00'>(2013-11-22)</time> </h1> </header> <p>I’m an engineer and a programmer, not an artist. This sometimes becomes an issue for me when I work on games as while I can make the game technically sound, the art is often downright horrible, or I spend <em>way</em> more time on it than I have any right to. I’m currently working on a long-term, back-burner type game project to keep me busy and distracted when I occasionally need a break from real life. Programming-wise, I’m fine, but what’s a game without art? Well, aside from <a href="http://www.bay12games.com/dwarves/">Dwarf Fortress</a> and most <a href="http://en.wikipedia.org/wiki/Roguelike">Roguelikes</a> out there, it’s not much. Fortunately, I recently stumbled across (what I think) is a <strong>great</strong> art style: <a href="http://cgcookie.com/blender/2013/06/19/creating-geometric-assets-in-blender/">geometric assets</a>, as shown below:</p> <figure> <img src="/images/unity-editor-extension-mesh-colour/geometric-ss-01.jpg"> <figcaption>Geometric Asset Scene by <a href="http://cgcookie.com/profile/metalix">Metalix</a></figcaption> </figure> <p>This is an art style that while it may take some ability to master and look great, I think it can look decent with relatively minimal work. Note that it is also really low-poly, so creating assets this way is <strong>great</strong> for mobile games (including things like the <a href="https://www.ouya.tv/">Ouya</a>). For information on creating this look in Blender, I can’t recommend enough the <a href="http://cgcookie.com/blender/2013/06/19/creating-geometric-assets-in-blender/">cgcookie tutorial on it</a> written / presented by <a href="http://www.metalix.co.nz/">Metalix Studios</a>. After creating these assets, we must import them into <a href="http://unity3d.com/">Unity</a>. Since Unity has such great support for Blender files, this is more or less of a non-issue, however when the models get imported into Unity they must use a special shader which will allow the colour to come out (these models aren’t textured at all). Metalix has also <a href="http://cgcookie.com/unity/2013/03/21/quick-tips-combining-multiple-materials-into-a-single-draw-call/">written a tutorial on this</a>, but I found their script a bit cumbersome to use to colour meshes with, so I decided to mod it a bit for my own use.</p> <p>My custom script makes use of an editor-extension to support multi-object colour editing as well as a saved palette of colours that you can easily pick from. This will take the inspector for these meshes from something that looks like:</p> <figure> <img src="/images/unity-editor-extension-mesh-colour/old-script.png"> <figcaption>Old Script Inspector</figcaption> </figure> <p>Into something that looks like:</p> <figure> <img src="/images/unity-editor-extension-mesh-colour/new-script.png"> <figcaption>New Script Inspector</figcaption> </figure> <p>Since I try to organize my projects extensively, I started by creating a new script in a folder called <code>Assets/Scripts/Customizations/MeshColour.cs</code>, with the contents:</p> <div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Generic</span><span class="p">;</span><span class="w"></span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MeshColour</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MonoBehaviour</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="n">meshColour</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">blue</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">HashSet</span><span class="p">&lt;</span><span class="n">Color</span><span class="p">&gt;</span><span class="w"> </span><span class="n">savedColours</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="p">&lt;</span><span class="n">Color</span><span class="p">&gt;();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div> <p>Note that there isn’t anything special here, other than remembering a mesh’s colour and keeping a static list of all colours in our palette. The real magic happens in a file I called <code>Assets/Scripts/Customizations/Editor/MeshColourEditor.cs</code>. Note that editor customization scripts <strong>MUST</strong> be located in a folder called <code>Editor</code> for them to work. Start off by adding the following to the file:</p> <div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEditor</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Generic</span><span class="p">;</span><span class="w"></span>

<span class="na">[CustomEditor(typeof(MeshColour))]</span><span class="w"></span>
<span class="na">[CanEditMultipleObjects]</span><span class="w"></span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MeshColourEditor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Editor</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div> <p>This just sets up the class to be an extension of the Editor class, for the <code>MeshColour</code> class defined before, and enabled multi-object editing on it. Multi-object editing is so that I can select say 5 trees and make them all the same colour at once rather than having to select each one individually. Next, we create a colour property which can be exposed to the user:</p> <div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEditor</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Generic</span><span class="p">;</span><span class="w"></span>

<span class="na">[CustomEditor(typeof(MeshColour))]</span><span class="w"></span>
<span class="na">[CanEditMultipleObjects]</span><span class="w"></span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MeshColourEditor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Editor</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">SerializedProperty</span><span class="w"> </span><span class="n">colourProp</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnEnable</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">colourProp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">serializedObject</span><span class="p">.</span><span class="n">FindProperty</span><span class="p">(</span><span class="s">&quot;meshColour&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnInspectorGUI</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// always do this at the beginning of OnInspectorGUI</span>
<span class="w">        </span><span class="n">serializedObject</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">// allow us to change our mesh colours</span>
<span class="w">        </span><span class="n">EditorGUILayout</span><span class="p">.</span><span class="n">PropertyField</span><span class="p">(</span><span class="n">colourProp</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">serializedObject</span><span class="p">.</span><span class="n">ApplyModifiedProperties</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div> <p>What this did was allow us to change the colour of the colour property (which points to the <code>MeshColour.meshColour</code> variable we defined in <code>MeshColour.cs</code>) across all the selected instances of objects with the <code>MeshColour</code> script attached. However, the script still isn’t that useful: if you run the script at this point, it won’t do anything (or at least, it won’t seem like it’s doing anything, as it’s just changing the <code>meshColour</code> property, which doesn’t actually apply colours to the meshes). In order to apply the mesh colour to the selected meshes, we’re going to need some more code:</p> <div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEditor</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Generic</span><span class="p">;</span><span class="w"></span>

<span class="na">[CustomEditor(typeof(MeshColour))]</span><span class="w"></span>
<span class="na">[CanEditMultipleObjects]</span><span class="w"></span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MeshColourEditor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Editor</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">SerializedProperty</span><span class="w"> </span><span class="n">colourProp</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnEnable</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">colourProp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">serializedObject</span><span class="p">.</span><span class="n">FindProperty</span><span class="p">(</span><span class="s">&quot;meshColour&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// get our selected game objects</span>
<span class="w">        </span><span class="n">Transform</span><span class="p">[]</span><span class="w"> </span><span class="n">transforms</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Selection</span><span class="p">.</span><span class="n">GetTransforms</span><span class="p">(</span><span class="w"></span>
<span class="w">              </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">Deep</span><span class="w"></span>
<span class="w">            </span><span class="p">|</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">ExcludePrefab</span><span class="w"></span>
<span class="w">            </span><span class="p">|</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">OnlyUserModifiable</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">meshes</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// loop over our selected transforms</span>
<span class="w">        </span><span class="k">foreach</span><span class="p">(</span><span class="n">Transform</span><span class="w"> </span><span class="n">transform</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">transforms</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// we have to instantiate a new mesh and set this objects mesh to the new one</span>
<span class="w">            </span><span class="n">MeshFilter</span><span class="w"> </span><span class="n">mf</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">transform</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshFilter</span><span class="p">&gt;();</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mf</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="n">Mesh</span><span class="w"> </span><span class="n">meshCopy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Mesh</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">mf</span><span class="p">.</span><span class="n">sharedMesh</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Mesh</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">Mesh</span><span class="w"> </span><span class="n">mesh</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mf</span><span class="p">.</span><span class="n">mesh</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">meshCopy</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">mesh</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mf</span><span class="p">.</span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">meshes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">mesh</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnInspectorGUI</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// always do this at the beginning of OnInspectorGUI</span>
<span class="w">        </span><span class="n">serializedObject</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">// allow us to change our mesh colours</span>
<span class="w">        </span><span class="n">EditorGUILayout</span><span class="p">.</span><span class="n">PropertyField</span><span class="p">(</span><span class="n">colourProp</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">serializedObject</span><span class="p">.</span><span class="n">ApplyModifiedProperties</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">// if we updated anything, update our mesh colours</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="n">changed</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Mesh</span><span class="w"> </span><span class="n">mesh</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">meshes</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">Color</span><span class="p">[]</span><span class="w"> </span><span class="n">colours</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Color</span><span class="p">[</span><span class="n">mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span><span class="w"></span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="n">colours</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="p">++)</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">colours</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">colourProp</span><span class="p">.</span><span class="n">colorValue</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="n">mesh</span><span class="p">.</span><span class="n">colors</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">colours</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div> <p>A lot changed here, but I will try to go over it all. First up, in the <code>OnEnable</code> function, we get a list of all the transforms that the user has currently selected using <a href="http://docs.unity3d.com/Documentation/ScriptReference/Selection.GetTransforms.html"><code>Selection.GetTransforms</code></a>. The options here will pick up all child transforms that aren’t prefabs (we don’t want to mess with those) and that are actually modifiable. Next, we go through our list of transforms and collect a list of all the meshes that are associated with those transforms (skipping any transforms that don’t have a mesh attached). For each mesh that we have, we actually instantiate a new copy of the shared mesh. This will result in a new mesh being created for each object (instead of each object sharing the same mesh) which will allow us to have multiple models but with different colours. Note that doing this <strong>will</strong> increase the number of draw calls, but I will address this issue in my next post. This <code>OnEnable</code> function will be called each time we select an object with the <code>MeshColour</code> script on it, so this list will only be updated when we select objects (which is what we want anyway). Next up, in the <code>OnInspectorGUI</code> function, we check if anything changed in the GUI (either the selected colour changed, or a button was pressed, etc). If something need change, we loop through all our previously stored meshes. For each of those meshes, we loop through all the vertices of that mesh and assign the new colour to those vertices. Once we’ve assigned all the colours, we store it back in the mesh, and we’re good to go!</p> <p>The above script works great, but I find it beneficial to generate a “palette” when I’m creating these assets so that I can quickly set the “trunk” colour of all my trees to be the same brown, for instance. While the Unity colour picker <em>does</em> allow you to save preset colours, you can’t access them until you’ve clicked on the colour box and moved your mouse over to the window - an inefficiency we can [relatively] easily solve. To add this functionality, we get to the following version of the script:</p> <div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEditor</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Generic</span><span class="p">;</span><span class="w"></span>

<span class="na">[CustomEditor(typeof(MeshColour))]</span><span class="w"></span>
<span class="na">[CanEditMultipleObjects]</span><span class="w"></span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MeshColourEditor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Editor</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">SerializedProperty</span><span class="w"> </span><span class="n">colourProp</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">List</span><span class="p">&lt;</span><span class="n">Mesh</span><span class="p">&gt;</span><span class="w"> </span><span class="n">meshes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="p">&lt;</span><span class="n">Mesh</span><span class="p">&gt;();</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnEnable</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">colourProp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">serializedObject</span><span class="p">.</span><span class="n">FindProperty</span><span class="p">(</span><span class="s">&quot;meshColour&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// get our selected game objects</span>
<span class="w">        </span><span class="n">Transform</span><span class="p">[]</span><span class="w"> </span><span class="n">transforms</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Selection</span><span class="p">.</span><span class="n">GetTransforms</span><span class="p">(</span><span class="w"></span>
<span class="w">              </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">Deep</span><span class="w"></span>
<span class="w">            </span><span class="p">|</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">ExcludePrefab</span><span class="w"></span>
<span class="w">            </span><span class="p">|</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">OnlyUserModifiable</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">meshes</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// loop over our selected transforms</span>
<span class="w">        </span><span class="k">foreach</span><span class="p">(</span><span class="n">Transform</span><span class="w"> </span><span class="n">transform</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">transforms</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// we have to instantiate a new mesh and set this objects mesh to the new one</span>
<span class="w">            </span><span class="n">MeshFilter</span><span class="w"> </span><span class="n">mf</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">transform</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshFilter</span><span class="p">&gt;();</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mf</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="n">Mesh</span><span class="w"> </span><span class="n">meshCopy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Mesh</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">mf</span><span class="p">.</span><span class="n">sharedMesh</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Mesh</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">Mesh</span><span class="w"> </span><span class="n">mesh</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mf</span><span class="p">.</span><span class="n">mesh</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">meshCopy</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">mesh</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mf</span><span class="p">.</span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">meshes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">mesh</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnInspectorGUI</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// always do this at the beginning of OnInspectorGUI</span>
<span class="w">        </span><span class="n">serializedObject</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">// allow us to change our mesh colours</span>
<span class="w">        </span><span class="n">EditorGUILayout</span><span class="p">.</span><span class="n">PropertyField</span><span class="p">(</span><span class="n">colourProp</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">serializedObject</span><span class="p">.</span><span class="n">ApplyModifiedProperties</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="n">GUILayout</span><span class="p">.</span><span class="n">BeginHorizontal</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">GUILayout</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="s">&quot;Save Colours:&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s">&quot;+&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">MeshColour</span><span class="p">.</span><span class="n">savedColours</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">colourProp</span><span class="p">.</span><span class="n">colorValue</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">MeshColour</span><span class="p">.</span><span class="n">savedColours</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">colourProp</span><span class="p">.</span><span class="n">colorValue</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">GUILayout</span><span class="p">.</span><span class="n">EndHorizontal</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">// display our saved colours list</span>
<span class="w">        </span><span class="n">GUILayout</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="s">&quot;Palette&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">HashSet</span><span class="p">&lt;</span><span class="n">Color</span><span class="p">&gt;.</span><span class="n">Enumerator</span><span class="w"> </span><span class="n">enu</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">MeshColour</span><span class="p">.</span><span class="n">savedColours</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasNext</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">enu</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">hasNext</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">GUILayout</span><span class="p">.</span><span class="n">BeginHorizontal</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="p">&amp;&amp;</span><span class="w"> </span><span class="n">hasNext</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="p">++)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">GUI</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">enu</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">hasNext</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">enu</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">colourProp</span><span class="p">.</span><span class="n">colorValue</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">GUI</span><span class="p">.</span><span class="n">color</span><span class="p">;</span><span class="w"></span>
<span class="w">                    </span><span class="n">serializedObject</span><span class="p">.</span><span class="n">ApplyModifiedProperties</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="n">GUILayout</span><span class="p">.</span><span class="n">EndHorizontal</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// if we updated anything, update our mesh colours</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="n">changed</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Mesh</span><span class="w"> </span><span class="n">mesh</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">meshes</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">Color</span><span class="p">[]</span><span class="w"> </span><span class="n">colours</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Color</span><span class="p">[</span><span class="n">mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span><span class="w"></span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="n">colours</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="p">++)</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">colours</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">colourProp</span><span class="p">.</span><span class="n">colorValue</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="n">mesh</span><span class="p">.</span><span class="n">colors</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">colours</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div> <p>What this added code does is first add two buttons (and a label) in a horizontal line across the inspector. When the <code>+</code> button is clicked, it simply adds the current selected colour to the static list stored in the <code>MeshColour</code> class (the palette of colours is stored as a <a href="http://msdn.microsoft.com/en-us/library/bb359438(v=vs.110).aspx"><code>HashSet</code></a> so that we don’t get duplicate colours). Similarly, <code>-</code> removes the colour. Next, we draw the Palette. We loop over every colour in our list, and for every 7 colours, we start a new horizontal row. In that row, we set the GUI colour to the current palette colour a draw an empty button for the user to click on. If they do click on it, we set the colour property to the saved colour and make sure to update it with <code>serializedObject.ApplyModifiedProperties()</code> (otherwise the colour picker won’t get updated). And that’s it!</p> <p>With this script in place we can now easily colour meshes to our hearts content! There’s just one more thing we can do to make our lives a bit easier, and that’s to create an easy way to add this script to all the meshes we want to colourize. I do that by adding a menu item to unity that when pressed will add the <code>MeshColour</code> script to all selected objects with both a <code>MeshFilter</code> and a <code>MeshRenderer</code> component attached:</p> <div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEditor</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections</span><span class="p">;</span><span class="w"></span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">AddMeshColourEditor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">EditorWindow</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// add a menu item to add this component to all children</span>
<span class="w">    </span><span class="na">[MenuItem(&quot;BlazingMammothGames/Geometric/Add Mesh Colour Editor&quot;)]</span><span class="w"></span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AddEditor</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">AddMeshColourEditor</span><span class="w"> </span><span class="n">window</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AddMeshColourEditor</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">window</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Rect</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="n">width</span><span class="w"> </span><span class="p">/</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="n">height</span><span class="w"> </span><span class="p">/</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">window</span><span class="p">.</span><span class="n">ShowUtility</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="na">[MenuItem(&quot;BlazingMammothGames/Geometric/Add Mesh Colour Editor&quot;, true)]</span><span class="w"></span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ValidateSelection</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Selection</span><span class="p">.</span><span class="n">GetTransforms</span><span class="p">(</span><span class="w"></span>
<span class="w">              </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">Deep</span><span class="w"></span>
<span class="w">            </span><span class="p">|</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">ExcludePrefab</span><span class="w"></span>
<span class="w">            </span><span class="p">|</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">OnlyUserModifiable</span><span class="p">).</span><span class="n">Length</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Material</span><span class="w"> </span><span class="n">addedMaterial</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">OnGUI</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">addedMaterial</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">Material</span><span class="p">)</span><span class="n">EditorGUILayout</span><span class="p">.</span><span class="n">ObjectField</span><span class="p">(</span><span class="s">&quot;Material:&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">addedMaterial</span><span class="p">,</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Material</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s">&quot;Add it!&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// get all our selected transforms</span>
<span class="w">            </span><span class="n">Transform</span><span class="p">[]</span><span class="w"> </span><span class="n">transforms</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Selection</span><span class="p">.</span><span class="n">GetTransforms</span><span class="p">(</span><span class="w"></span>
<span class="w">              </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">Deep</span><span class="w"></span>
<span class="w">            </span><span class="p">|</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">ExcludePrefab</span><span class="w"></span>
<span class="w">            </span><span class="p">|</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">.</span><span class="n">OnlyUserModifiable</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="c1">// only add the component if there is both a mesh filter and a mesh renderer</span>
<span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Transform</span><span class="w"> </span><span class="n">transform</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">transforms</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w">   </span><span class="n">transform</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshFilter</span><span class="p">&gt;()</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="k">null</span><span class="w"></span>
<span class="w">                    </span><span class="p">&amp;&amp;</span><span class="w"> </span><span class="n">transform</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshRenderer</span><span class="p">&gt;()</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">transform</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">MeshColour</span><span class="p">&gt;();</span><span class="w"></span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">addedMaterial</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="n">transform</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshRenderer</span><span class="p">&gt;().</span><span class="n">material</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">addedMaterial</span><span class="p">;</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="c1">// close our window</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div> <p>This code just adds a menu item (in the “BlazingMammothGames -&gt; Geometric” menu section) that when clicked will show a popup window. With a place to put a material. This will be the material used when adding the <code>MeshRenderer</code> component. When the <code>Add it!</code> button is clicked, we loop through all the selected transforms and add the <code>MeshColour</code> component to each one that has both a <code>MeshFilter</code> and <code>MeshRenderer</code> component, injecting the material along the way.</p> <p>Voilà!</p> <script src="/ruffle/ruffle.js"></script> </article> </main> <footer> <p> <span>© 2022 <a href="https://hamaluik.ca">Kenton Hamaluik</a></span> <span><a class="has-icon" href="https://blog.hamaluik.ca/feed.rss"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><path d="M48,144a64,64,0,0,1,64,64" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M48,96A112,112,0,0,1,160,208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M48,48A160,160,0,0,1,208,208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><circle cx="52" cy="204" r="12"></circle></svg> Subscribe</a></span> </p> </footer> </body> </html>